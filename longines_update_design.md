# Longinesタブ更新 設計書

## 📊 現状分析

### 現在のHTML（古いデータ）
- **総販売数**: 219個
- **中央値**: $262.95
- **CV値**: 1.090
- **型番抽出率**: 64.2%

### 最新データ（Excel + CSV）
- **出品数**: 2,981件
- **販売数**: 2,984個（完品のみ: 2,954個）
- **平均価格**: $389.55
- **中央値**: $269.99
- **CV値**: 0.904
- **順位**: 全ブランド中3位（Longines）

### **ギャップ**
- 販売数: **219個 → 2,984個（13.6倍）**
- データが圧倒的に不足している

---

## 🎯 更新目的

1. **最新データへの完全置き換え**: 2,984個の販売データを反映
2. **ライン別分析の精度向上**: 7ラインの詳細統計
3. **駆動方式別分布の更新**: クオーツ67.8%が主流
4. **仕入れ戦略の最新化**: 最新の市場トレンドに基づく推奨

---

## 📋 現在のHTMLセクション構成

Longinesタブは以下の7セクションで構成：

1. **基本統計**（4カード）
   - 総販売数、中央値、CV値、型番抽出率
2. **仕入れ戦略**（実践ガイド）
   - 狙い目条件、避けるべき条件、仕入れ価格目安
3. **市場分析グラフ**（4グラフ）
   - 価格帯別、駆動方式別、性別・カテゴリー別、ライン別売上比率
4. **特別版・限定モデル分析**
   - Navigation Limited、Anniversary等の分析
5. **各ラインの人気モデルTop15**
   - ライン別の詳細テーブル
6. **ライン別詳細分析**（全6ライン）
   - ライン別の統計テーブル + 検索リンク
7. **全ライン横断 型番分析Top30**
   - 全体の人気型番ランキング

---

## 📊 最新データ詳細

### 駆動方式別（完品のみ）
| 駆動方式 | 販売数 | 比率 |
|----------|--------|------|
| クオーツ | 2,004個 | 67.8% |
| 自動巻 | 447個 | 15.1% |
| 不明 | 300個 | 10.2% |
| 手巻き | 203個 | 6.9% |

### ライン別（完品のみ）
| ライン | 販売数 | 比率 |
|--------|--------|------|
| その他Longines | 2,058個 | 69.7% |
| Conquest | 490個 | 16.6% |
| DolceVita | 161個 | 5.5% |
| Flagship | 132個 | 4.5% |
| HydroConquest | 51個 | 1.7% |
| Heritage | 45個 | 1.5% |
| Spirit | 17個 | 0.6% |

### 価格帯
- **最低価格**: $35.00
- **中央値**: $269.99
- **平均価格**: $388.55
- **最高価格**: $4,778.50

---

## 🔧 更新方針

### 1. データソース
- **完品データのみ使用**: `商品状態 == '完品'`
- **CSVから直接生成**: Excelシートとの整合性を確認
- **型番抽出**: タイトルから型番を抽出（Lで始まる型番パターン）

### 2. ライン分類ロジック
タイトル文字列から以下のキーワードで分類：
```python
- 'Conquest' → Conquest
- 'Flagship' → Flagship
- 'Heritage' → Heritage
- 'DolceVita' or 'Dolce Vita' → DolceVita
- 'Spirit' → Spirit
- 'HydroConquest' or 'Hydro Conquest' → HydroConquest
- その他 → その他Longines
```

### 3. 特別版・限定モデル
タイトルから以下を抽出：
- Anniversary（記念モデル）
- Limited（限定版）
- Chronometer（クロノメーター）
- Navigation（ナビゲーション）

### 4. 型番抽出ロジック
正規表現でLonginesの型番を抽出：
```python
pattern = r'L\d+\.\d+\.\d+'  # 例: L4.635.2
```

### 5. グラフ・テーブル生成
- **価格帯別**: 50ドル刻みで分布
- **駆動方式別**: 円グラフ（クオーツ、自動巻、手巻き、不明）
- **性別分布**: デパートメント列から集計
- **ライン別**: 7ラインの円グラフ
- **Top30人気型番**: 販売数順にランキング
- **ライン別Top15**: 各ラインの人気モデル

---

## 🚨 重要な注意点（CLAUDE.mdより）

### HTMLタブ置換の正しい方法
1. **正規表現を使わない**: 文字列位置ベースの分割・結合
2. **ネストカウントで終了位置を特定**: `<div>`の開始と終了を正確にカウント
3. **挿入位置の目視確認**: 前後50文字を表示して確認

### 実装前の確認
- [ ] 挿入位置を文字列位置で特定
- [ ] ネストされた`<div>`の終了位置をカウントで特定
- [ ] 挿入位置の前後50文字を表示して目視確認

### 実装後の検証
- [ ] タブコンテンツdivの存在確認
- [ ] データ行数確認（Top30が30行、ライン別詳細が7行）
- [ ] ファイルサイズの増加確認
- [ ] ブラウザで実際に表示確認

---

## 📝 実装手順

### Phase 1: データ生成スクリプト作成
1. `rebuild_longines_complete.py` を作成
2. CSVから完品データ抽出
3. ライン分類・型番抽出
4. 統計計算（販売数、中央値、CV値）
5. グラフデータ生成（JSON形式）
6. HTMLテンプレート生成

### Phase 2: HTML置換
1. `index.html`からLonginesタブの開始位置を特定
   - `<div id="Longines"` を検索
2. ネストカウントで終了位置を特定
3. 文字列位置ベースで置換
4. ファイルサイズ確認

### Phase 3: 検証
1. ブラウザでLonginesタブを開く
2. 基本統計の値を確認（総販売数: 2,984個）
3. グラフが正しく表示されているか確認
4. テーブルのデータ行数を確認

---

## 🎨 ブランドカラー

**Longines**: ブルー系（既存のまま）
- プライマリ: `#1565c0`
- セカンダリ: `#e3f2fd`

---

## 💡 仕入れ戦略の更新

### 狙い目条件（最新トレンドに基づく）
1. **Conquest**: 最多販売数（490個）、スポーツウォッチとして人気
2. **DolceVita**: エレガントライン（161個）、安定需要
3. **Flagship**: フラッグシップライン（132個）
4. **クオーツモデル**: 67.8%がクオーツ、低価格で回転が早い

### 避けるべき条件
1. CV値 0.5以上の不安定なモデル
2. 型番不明瞭な商品（パーツ・ケースの可能性）
3. 極端な高額品（$2,000以上）

### 仕入れ価格目安
- **通常モデル**: $150-300（¥23,000-46,000）
- **Conquest/DolceVita**: $200-400（¥31,000-62,000）
- **Heritage/Spirit**: $500-1,500（¥78,000-233,000）

---

## ✅ 成功基準

1. **総販売数が2,984個に更新されている**
2. **ライン別データが7ライン表示されている**
3. **グラフが4つ正しく表示される**
4. **検索リンクとチェックボックスが機能する**
5. **ファイルサイズが増加している**
6. **ブラウザで実際に表示・動作確認できる**

---

## 🚀 次のアクション

1. ✅ **設計書作成完了**（このファイル）
2. ✅ **3者協議実施**（GPT・Gemini・Claudeで議論）
3. ⏳ **rebuild_longines_complete.py 作成**
4. ⏳ **スクリプト実行**
5. ⏳ **ブラウザで検証**
6. ⏳ **Git commit & Obsidianノート作成**

---

## 📋 3者協議の結論（追加要件）

### GPT・Geminiからの重要な指摘

**優先度1: エラーログ実装（必須）**
- 型番抽出失敗のログ出力: `extraction_errors.log`
- 抽出率の表示: "型番抽出: 2,450/2,954件 (82.9%)"
- 未抽出タイトル一覧を記録（事後確認用）

**優先度2: 可視化調整（推奨）**
- Top30の基準を明示（販売数順）
- グラフの透明度調整（密集対策）
- 外れ値の注釈追加

**優先度3: 設定外部化（将来課題）**
- ライン分類キーワードをスクリプト冒頭に定数定義
- 将来的にJSON/YAML化を検討

### 実装方針の修正

```python
# スクリプト実行時に以下を出力
print("📊 データ読み込み完了")
print(f"   完品データ: {len(longines):,}件")
print(f"   総販売数: {total_sales:,}個")
print(f"\n🔍 型番抽出結果")
print(f"   成功: {extracted_count:,}件 / {len(longines):,}件 ({extraction_rate:.1f}%)")
print(f"   失敗: {failed_count:,}件")
print(f"   ログ: extraction_errors.log に保存")
```

### バックアップ・検証の必須化

1. HTML置換前にバックアップ作成: `index.html.backup`
2. 置換後に差分確認: 挿入位置の前後50文字を表示
3. ファイルサイズ確認: 増加していることを確認

---

**作成日**: 2026-01-30
**対象ファイル**: `index.html`
**データソース**: `~/Desktop/時計データ_分類済み.csv`、`分析シート.xlsx`
